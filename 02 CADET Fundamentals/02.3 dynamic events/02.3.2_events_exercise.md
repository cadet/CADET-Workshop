---
jupytext:
  formats: ipynb,md:myst
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.16.4
kernelspec:
  display_name: Python 3 (ipykernel)
  language: python
  name: python3
---

+++ {"editable": true, "slideshow": {"slide_type": ""}}

# Dynamic Events - Exercises

+++ {"editable": true, "slideshow": {"slide_type": ""}}

## Exercise 1: Load - Wash - Elute

Extend the SMA model from the previous exercise and divide it into sections:
- __a load section__: during which the column is loaded with 1 mol of Protein while being held at 50 mM salt concentration
- __a wash section__: during which the column is washed with 50 mM salt buffer for 3 column volumes to allow non-binding protein to elute
- __an elute section__: during which the column is brought to 1000 mM salt buffer to elute the bound proteins.

Try experimenting with:
- The binding strenth.
- The slope / duration of the gradient.

```{code-cell} ipython3
---
editable: true
slideshow:
  slide_type: ''
tags: [solution]
---
from CADETProcess.processModel import ComponentSystem
import numpy as np

component_system = ComponentSystem(["Salt", "A", "B"])

# Unit Operations
from CADETProcess.processModel import Inlet, LumpedRateModelWithoutPores, Outlet, StericMassAction

flow_rate = 8.33e-9

## Inlet
# We assume constant flow and constant inlet concentrations.
inlet = Inlet(component_system, 'inlet')
inlet.flow_rate = flow_rate

binding_model = StericMassAction(component_system, name='langmuir')
binding_model.is_kinetic = True
binding_model.adsorption_rate = [0, 1e-5, 1e-1, 1e-3]
binding_model.desorption_rate = [0, 1, 1, 1]
binding_model.characteristic_charge = [0, 5, 1, 7]
binding_model.steric_factor = [0, 1, 1, 1]
binding_model.capacity = 1200

column = LumpedRateModelWithoutPores(component_system, name='column')
column.binding_model = binding_model

column.c = [50, 0, 0]
column.q = [50, 0, 0]
column.total_porosity = 0.5
column.length = 2e-2
column.diameter = np.sqrt(5.03e-5 / 3.14) * 2
column.axial_dispersion = 1e-7

outlet = Outlet(component_system, 'outlet')

# Flow Sheet
from CADETProcess.processModel import FlowSheet

flow_sheet = FlowSheet(component_system)

flow_sheet.add_unit(inlet)
flow_sheet.add_unit(column)
flow_sheet.add_unit(outlet)

flow_sheet.add_connection(inlet, column)
flow_sheet.add_connection(column, outlet)

from CADETProcess.processModel import Process
process = Process(flow_sheet,"process")

gradient_length = column.volume / flow_rate * 30

process.add_event("load_start", "flow_sheet.inlet.c", [[50], [1], [1]], time=0)
process.add_event("wash_start", "flow_sheet.inlet.c", [[100], [0], [0]], time=10)
# process.add_event("elute_start", "flow_sheet.inlet.c", [[1000], [0], [0]], time=column.volume / flow_rate * 3 + 10)
process.add_event("elute_start", "flow_sheet.inlet.c", [[100, 900/gradient_length, 0, 0], [0], [0]], time=column.volume / flow_rate * 3 + 10)
process.add_event("elute_end", "flow_sheet.inlet.c", [[1000, 0, 0, 0], [0], [0]], time=column.volume / flow_rate * 3 + 10 + gradient_length)

process.cycle_time = column.volume / flow_rate * 3 + 10 + gradient_length + 100

process.plot_events()
from CADETProcess.simulator import Cadet

simulator = Cadet()

sim_results = simulator.simulate(process)
```

```{code-cell} ipython3
---
editable: true
slideshow:
  slide_type: ''
---
from CADETProcess.plotting import SecondaryAxis

sec = SecondaryAxis()
sec.components = ['Salt']
sec.y_label = '$c_{salt}$'

_ = sim_results.solution.outlet.outlet.plot(secondary_axis=sec, x_axis_in_minutes=False)
```

```{code-cell} ipython3
:tags: [solution]


```
